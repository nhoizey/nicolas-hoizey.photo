{% from "macros/meta.njk" import meta %}

{% macro photo(item, loading=false, env='production', slug=false) %}

  {% if item.data.origin %}
    {% set dimensions = item.data.origin.data.dimensions %}
  {% else %}
    {% set dimensions = item.data.dimensions %}
  {% endif %}

  {% if env == 'production' %}
    {% set imageFile = item.data.page.fileSlug %}
  {% else %}
    {# Prevent loading the huge image in development #}
    {% set imageFile = 'small' %}
  {% endif %}

  <figure>
    <img
      src="/photos/{{ item.data.page.fileSlug }}/{{ imageFile }}.jpg"
      alt="{{- item.data.origin.data.alt_text or item.data.title -}}"
      class="frame{% if dimensions.width < dimensions.height %} portrait{% endif %}"
      {% if dimensions.width %}width="{{ dimensions.width }}"{% endif %}
      {% if dimensions.height %}height="{{ dimensions.height }}"{% endif %}
      style="background-color: rgb({{ item.data.origin.data.colors.muted }} / 50%)"
      {% if loading %}
        loading="{{ loading }}"
        {% if loading == 'lazy' %}
          decoding="async"
        {% endif %}
      {% endif %}
      data-responsiver="thumbnail_{% if dimensions.width < dimensions.height %}portrait{% else %}landscape{% endif %}"
    />
    <figcaption>
      <a href="{{ item.page.url }}">{{ item.data.title }}</a>
      {{ meta(item) }}
    </figcaption>
  </figure>
  {% if slug %}
    <input type="text" size="20" value="{{ item.page.fileSlug }}.md" style="font-size: .6em" onclick="this.select();document.execCommand('copy')"/>
  {% endif %}

{% endmacro %}
