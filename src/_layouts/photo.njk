{% extends "./base.njk" %}

{% if origin %}
  {% set dimensions = origin.data.dimensions %}
  {% set gear = origin.data.gear %}
  {% set settings = origin.data.settings %}
  {% set geo = origin.data.geo %}
  {% set content = content or origin.content %}
  {% set tags = origin.data.tags %}
  {% set colors = origin.data.colors %}
  {% set dates = origin.data.dates %}
{% endif %}

{% block description %}
  <meta property="og:description" name="description" content="{{ content | markdownify | excerpt | striptags | safe }}" />
{% endblock %}

{% block styles %}
  style="--ambiant-background: #{{ colors.darkMuted | bgcolor }}"
{% endblock %}

{% block opengraphimage %}
  {% set opengraphFile = 'src/photos/' + page.fileSlug + '/opengraph.jpg' %}
  {% if opengraphFile | exists %}
  <meta property="og:image" content="{{ site.url }}/photos/{{ page.fileSlug }}/opengraph.jpg" />
  {% endif %}
{% endblock %}

{% block content %}
  {% from "macros/css.njk" import css %}
  {{ css('components/photo', build.env) }}

  {% set breadcrumb = collections.photo_galleries | breadcrumb(page.url) %}

  {% include 'components/json-ld/breadcrumb.njk' %}

  <div class="photo{% if dimensions.width < dimensions.height %} portrait{% endif %} h-entry" style="--ratio: {{ dimensions.width / dimensions.height }}; --ambiant-foreground: #{{ colors.darkMuted | fgcolor }}">
    <div class="header">
      {% include 'components/breadcrumb.njk' %}
      <h1>{{ title }}</h1>
    </div>

    <img
      src="/photos/{{ page.fileSlug }}/{{ page.fileSlug }}.jpg"
      class="image u-photo"
      alt="{{ title }}"
      width="{{ dimensions.width }}"
      height="{{ dimensions.height }}"
      style="background-color: #{{ colors.muted | bgcolor }}"
      {% if dimensions.width < dimensions.height %}
        data-responsiver="portrait"
      {% else %}
        data-responsiver="landscape"
      {% endif %}
      fetchpriority="high"
    />

    <div class="description p-content">
      {{ content | markdownify | safe }}
    </div>

    <div class="meta">
      <ul class="exif">
        <li class="date"><svg class="icon" aria-hidden="true"><use xlink:href="#date-icon" /></svg> <time class="dt-published" datetime="{{ dates.iso }}">{{ dates.human }}</time></li>
        {% if gear and gear.camera %}
        <li class="gear">{% inline_icon 'camera' %}
          <a href="/gear/{{ gear.camera.brand | slugify }}/{{ gear.camera.model | slugify }}/">{{ gear.camera.brand }} {{ gear.camera.model }}</a>
        </li>
        {% endif %}
        {% if settings.focal_length or gear.lenses %}
          <li class="lens">{% inline_icon 'focal_length' %}
            {% if gear.lenses %}
              {% set comma = joiner(", ") %}
              {% for lens in gear.lenses %}
                {{- comma() }}
                <a href="/gear/{{ lens.brand | slugify }}/{{ lens.model | slugify }}/">{{ lens.brand }} {{ lens.model }}</a>
              {% endfor %}
              <br />
            {% endif %}
            {{ settings.focal_length }} mm
            {% if settings.focal_length_35mm %} (eq {{ settings.focal_length_35mm }} mm){% endif %}
          </li>
        {% endif %}
        {% if settings.iso %}<li class="iso">{% inline_icon 'iso' %} ISO {{ settings.iso }}</li>{% endif %}
        {% if settings.aperture %}<li class="aperture">{% inline_icon 'aperture' %} ƒ/{{ settings.aperture }}</span></li>{% endif %}
        {% if settings.shutter_speed %}<li class="shutter_speed">{% inline_icon 'shutter_speed' %} {{ settings.shutter_speed }} s</li>{% endif %}
      </ul>
      <div class="geo">
        {% if geo.latitude and geo.longitude %}

          {% from "macros/css.njk" import css %}
          {{ css('components/photo-map', build.env) }}

          <div id="map">
            {% if geo.map %}
              <img src="/photos/{{ page.fileSlug }}/map.png" width="300" height="200" alt="Map showing location of “{{ title }}”{% if geo.city and geo.country %} in {{ geo.city }}, {{ geo.country }}{% endif %}" fetchpriority="low" data-responsiver="photo_map" />
            {% else %}
              <img src="https://api.mapbox.com/styles/v1/{{ map.mapbox.style }}/static/{{ geo.longitude }},{{ geo.latitude }},10/450x300?access_token={{ env.MAPBOX_ACCESS_TOKEN }}" crossorigin="anonymous" width="300" height="200" alt="Map showing location of “{{ title }}”{% if geo.city and geo.country %} in {{ geo.city }}, {{ geo.country }}{% endif %}" fetchpriority="low" data-responsiver="false" />
            {% endif %}
            <div class="marker-shadow"></div>
            <div class="marker"></div>
          </div>
          {% if geo.city or geo.country %}<p class="h-adr">{% if geo.city %}<span class="p-locality">{{ geo.city }}</span>{% endif %}{% if geo.city and geo.country %}, {% endif %}{% if geo.country %}<span class="p-country-name">{{ geo.country }}</span>{% endif %}</p>{% endif %}
          <p class="locate"><svg class="icon" aria-hidden="true"><use xlink:href="#map-icon" /></svg> Locate it on the <a href="/map/#13/{{ geo.latitude }}/{{ geo.longitude }}">interactive global map</a></p>
        {% endif %}
      </div>
    </div>
    {% if tags %}
    <p class="tags">
      {% inline_icon 'tag' %}
      {%- for tag in tags -%}
        <a href="/tags/{{ tag | slugify }}/" rel="tag" class="p-category">{{ tag }}</a>
      {%- endfor -%}
    </p>
    {% endif %}
  </div>
{% endblock %}
